ifeq ($(strip $(TARGET_DEA_SDIMAGE)),true)

MKSDIMAGE := $(TOPDIR)device/digi/build/tools/mksdimage.sh

INSTALLED_SDIMAGE_TARGET := $(PRODUCT_OUT)/sdcard.img
INSTALLED_SDIMAGE_TARGET_GZ := $(INSTALLED_SDIMAGE_TARGET).gz

TARGET_UBOOT_IMAGES := $(foreach config, $(TARGET_BOOTLOADER_CONFIG), $(PRODUCT_OUT)/u-boot-$(firstword $(subst :, ,$(config))).imx)
SDIMG_UBOOT := $(firstword $(TARGET_UBOOT_IMAGES))

.PHONY: sdimage
sdimage: $(INSTALLED_SDIMAGE_TARGET_GZ)

$(INSTALLED_SDIMAGE_TARGET_GZ): $(UBOOT_BIN) $(INSTALLED_BOOTIMAGE_TARGET) $(INSTALLED_SYSTEMIMAGE) $(INSTALLED_VENDORIMAGE_TARGET) | $(MINIGZIP) $(SIMG2IMG)
	$(call pretty,"Target DEA sdcard image: $@")
	$(hide) BOOTLOADER_OFFSET=$(BOOTLOADER_OFFSET) $(MKSDIMAGE) \
		-u $(SDIMG_UBOOT) \
		-b $(INSTALLED_BOOTIMAGE_TARGET) \
		-s $(INSTALLED_SYSTEMIMAGE) \
		-v $(INSTALLED_VENDORIMAGE_TARGET) \
		$(INSTALLED_SDIMAGE_TARGET)
	$(hide) $(MINIGZIP) < $(INSTALLED_SDIMAGE_TARGET) > $@
	$(hide) rm -f $(INSTALLED_SDIMAGE_TARGET)

droidcore: $(INSTALLED_SDIMAGE_TARGET_GZ)

endif
